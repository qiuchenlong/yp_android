<!DOCTYPE html>
<html ng-app="myApp">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link href="../css/swiper.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="../css/api.css" />
	<style type="text/css">
		.top {
			height: 40px;
			background: #ffffff;
			top: -5px;
		}

		.search {
			float: left;
			width: 90%;
			margin-top: 5px;
			margin-left: 5%;
		}

		.searchInput {
			width: 100%;
			background: url(../image/zui_search_ico.png) no-repeat 10px #f3f3f3;
			background-size: 16px;
			background-position: 30%;
			height: 25px !important;
			line-height: 25px;
			font-size: 12px !important;
			border: none;
			border: 1px solid #cccccc;
			border-radius: 30px;
			outline: none;
			color: #666666;
			text-align: center;
		}



		.classify {
			padding: 15px 0 0;
			background: white;
		}

		.classify ul li {
			float: left;
			width: 20%;
			text-align: center;
			font-size: 14px;
			color: #484848;
		}

		.classify ul li img {
			width: 50%;
			height: 30px;
		}

		.bookList {
			background: white;
		}

		.bookList ul li {
			float: left;
			width: 32.5%;
			text-align: center;
			font-size: 14px;
		}

		.bookList ul li img {
			width: 80%;
		}

		.bookList ul li .bookName {
			width: 70%;
			margin: 10px auto;
			font-size: 12px;
			color: #676767;
			height: 26px;
			line-height: 13px;
			overflow: hidden;
			text-overflow: ellipsis;
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
		}

		.title {
			font-size: 16px;
			/*line-height:45px;*/
			padding: 12px 0;
			padding-left: 10px;
			color: #484848;
			font-weight: 600
		}


		.booksList2 {
			background: white;
			margin-top: 5px;
			padding: 0 10px 5px 10px;
		}

		.booksList2 ul li {
			border-bottom: 1px solid #f3f3f3;
			margin-bottom: 10px;
			padding-bottom: 10px;
		}

		.booksList2 ul li:last-child {
			border-bottom: 0;
		}

		.booksList2 ul li .bookCover {
			float: left;
			width: 20%;
			margin-bottom: 10px;
			margin-top: 10px;
		}

		.booksList2 ul li .bookCover img {
			width: 100%;
			height: 85px;

		}

		.booksList2 ul li .bookInfo {
			float: left;
			width: 76%;
			margin-left: 3%;
			font-size: 11px;
			color: #787878;
			line-height: 15px;
		}

		.booksList2 ul li .bookInfo .booksName {
			font-size: 13px;
			color: #484848;
			margin-top: 5px;
			line-height: 25px;
		}

		.booksList2_title {
			padding: 0;
		}

		#swiper2,
		#swiper1 {
			height: 35px;
			line-height: 35px;
			font-size: 14px;
			border-bottom: 1px solid #dedede;
			color: #484848;
			background: white;
			padding: 0 10px;
		}

		.icon-laba {
			font-size: 20px;
			float: left;
			margin-right: 5px;
			color: #494DF1;
		}

		.button {
			padding: 10px;
			text-align: center;
		}

		.button span {
			display: inline-block;
			width: 90%;
			text-align: center;
			line-height: 30px;
			border-radius: 3px;
			color: white;
		}

		.txt {
			overflow: hidden;
			text-overflow: ellipsis;
			display: -webkit-box;
			-webkit-line-clamp: 3;
			-webkit-box-orient: vertical;
		}

		.author {
			margin-top: 15px;
			color: #484848;
		}

		.author img {
			width: 10px;
			height: 10px;
			vertical-align: middle;
		}

		.label {
			padding: 1px;
			line-height: 15px;
			float: right;
			border: 1px solid #bbdba8;
			border-radius: 3px;
			color: #bbdba8;
			margin-right: 5px;
		}

		.labels {
			padding: 1px;
			line-height: 15px;
			margin-right: 5px;
			float: right;
			border: 1px solid #99bbda;
			border-radius: 3px;
			color: #99bbda;
		}

		.hotList {
			background: white;
			margin-top: -5px;
		}

		.hotList>ul>li {
			line-height: 40px;
			padding: 0 10px;
			font-size: 14px;
			border-bottom: 1px solid #f1f1f1;
		}

		.hotList>ul>li:last-child {
			border: 0
		}

		.hotList>ul>li .sort {
			width: 24px;
			height: 24px;
			line-height: 25px;
			text-align: center;
			background: #FF3A3A;
			border-radius: 50%;
			color: white;
		}

		.hotList>ul>li .booksName {
			margin-left: 10px;
		}

		.hotList>ul>li .label {
			margin-top: 9px;
		}

		.ad_img {
			width: 100%;
			height: auto;
		}

		.redu {
			width: 100%;
			height: 30px;
			line-height: 30px;
			background: #ffffff;
			text-align: left;
			font-size: 14px;
		}

		.redu span {
			min-width: 23%;
			margin-left: 3%;
			line-height: 20px;
			height: 20px;
			text-align: center;
		}

		.huang_se {
			color: #1ba976;
			border: #1ba976 1px solid;
			border-radius: 15px;
		}

		.swiper-slide span {
			width: 23%;
			overflow: hidden;
			min-width: 50px;
			line-height: 20px;
			height: 20px;
			text-align: center;
		}
	</style>
</head>

<body ng-controller="DataController">
	<!--	<div class="top">
		<div class="search" ng-click="ceshi()">
			1325
		</div>
	</div>-->

	<div class="swiper-container" id="swiper1">
		<div class="swiper-wrapper" id="fengqiang">
			<!--<div class="swiper-slide">
				<span class="huang_se" >全部</span>
				<span >都市生活</span>
				<span >热血暧昧</span>
				<span >都市异能</span>
			</div>
			<div class="swiper-slide">
			    <span >全部2</span>
				<span >都市生活2</span>
				<span >热血暧昧2</span>
				<span >都市异能3</span>
			</div>
			<div class="swiper-slide">
				<span >全部3</span>
				<span >都市生活3</span>
				<span >热血暧昧2</span>
				<span >都市异能3</span>
			</div>-->
		</div>
	</div>
	<div class="swiper-container" id="swiper2">
		<div class="swiper-wrapper">
			<div class="swiper-slide">
				<span class="huang_se" id='100' ng-click="zishus('','100')">全部</span>
				<span id="101" ng-click="zishus('1','101')">30万字以下</span>
				<span id="102" ng-click="zishus('2','102')">30-100万字</span>
				<span id="103" ng-click="zishus('3','103')">100万字以上</span>
			</div>
			<!--<div class="swiper-slide">
			    <span >全部2</span>
				<span >都市生活2</span>
				<span >热血暧昧2</span>
				<span >都市异能3</span>
			</div>
			<div class="swiper-slide">
				<span >全部3</span>
				<span >都市生活3</span>
				<span >热血暧昧2</span>
				<span >都市异能3</span>
			</div>-->
		</div>
	</div>
	<div class="redu">
		<span class="huang_se" style="margin-left: 3%;" id='104' ng-click="xingshi('',104)">全部</span>
		<span id='105' ng-click="xingshi('0',105)">更新</span>
		<span id='106' ng-click="xingshi('3',106)">完结</span>
	</div>

	<div class="booksList2">
		<ul>
			<li class="clearfix" ng-repeat="b in bookList" ng-click="bookdetail(b.articleid)">
				<div class="bookCover">
					<img src="{{imgurl + b.images}}" alt="" />
				</div>
				<div class="bookInfo">
					<p class="booksName">{{b.articlename}}</p>
					<p class="txt">
						{{b.intro}}
					</p>
					<div class="author">
						<span>
							<i class="iconfont">
								<img src="../image/authors.png" />
							</i>
							{{b.author}}
						</span>

						<span class="labels">
							{{b.shortname}}
						</span>
						<span class="label">
							{{(b.size/20).toFixed(1)}}万字
						</span>
					</div>
				</div>
			</li>
			<!--<li class="clearfix">
				<div class="bookCover">
					<img src="../image/book0.png" alt="" />
				</div>
				<div class="bookInfo">
					<p class="booksName">在时光尽头等你</p>
					<p class="txt">
						小四有次在接受采访的时候提到齐名的死，他不是因为对易瑶的死内疚或是对森湘的死痛苦才自杀的
						，齐名总是
					</p>
					<div class="author">
						<span>
							<i class="iconfont"><img src="../image/authors.png"/></i>
							倾城
						</span>

						<span class="labels">
							都市言情
						</span>
						<span class="label">
							10万字
						</span>
					</div>
				</div>
			</li>
			<li class="clearfix">
				<div class="bookCover">
					<img src="../image/book0.png" alt="" />
				</div>
				<div class="bookInfo">
					<p class="booksName">在时光尽头等你</p>
					<p class="txt">
						小四有次在接受采访的时候提到齐名的死，他不是因为对易瑶的死内疚或是对森湘的死痛苦才自杀的
						，齐名总是
					</p>
					<div class="author">
						<span>
							<i class="iconfont"><img src="../image/authors.png"/></i>
							倾城
						</span>

						<span class="labels">
							都市言情
						</span>
						<span class="label">
							10万字
						</span>
					</div>
				</div>
			</li><li class="clearfix">
				<div class="bookCover">
					<img src="../image/book0.png" alt="" />
				</div>
				<div class="bookInfo">
					<p class="booksName">在时光尽头等你</p>
					<p class="txt">
						小四有次在接受采访的时候提到齐名的死，他不是因为对易瑶的死内疚或是对森湘的死痛苦才自杀的
						，齐名总是
					</p>
					<div class="author">
						<span>
							<i class="iconfont"><img src="../image/authors.png"/></i>
							倾城
						</span>

						<span class="labels">
							都市言情
						</span>
						<span class="label">
							10万字
						</span>
					</div>
				</div>
			</li><li class="clearfix">
				<div class="bookCover">
					<img src="../image/book0.png" alt="" />
				</div>
				<div class="bookInfo">
					<p class="booksName">在时光尽头等你</p>
					<p class="txt">
						小四有次在接受采访的时候提到齐名的死，他不是因为对易瑶的死内疚或是对森湘的死痛苦才自杀的
						，齐名总是
					</p>
					<div class="author">
						<span>
							<i class="iconfont"><img src="../image/authors.png"/></i>
							倾城
						</span>

						<span class="labels">
							都市言情
						</span>
						<span class="label">
							10万字
						</span>
					</div>
				</div>
			</li>-->

		</ul>
	</div>
	<div class="bottom_loadmore"></div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/jquery-2.1.4.js"></script>
<script src="../script/swiper.min.js"></script>
<script src="../script/angular.min.js"></script>
<script src="../script/ionic.bundle.js"></script>
<script src="../script/ev.js"></script>
<script type="text/javascript">
	$(function () {
		var mySwiper2 = new Swiper('#swiper1', {
			//			autoplay: 3000,//可选选项，自动滑动
			slidesPerView: 1,
			//			direction : 'vertical',
			//          pagination: '.swiper-pagination',
			paginationClickable: true,
			spaceBetween: 0,
			loop: false,

		})
	})


	//		$(function(){
	//		var mySwiper2 = new Swiper('#swiper2', {
	////			autoplay: 3000,//可选选项，自动滑动
	//			slidesPerView: 1,
	////			direction : 'vertical',
	////          pagination: '.swiper-pagination',
	//			paginationClickable: true,
	//			spaceBetween: 0,
	//			loop: false,
	//
	//		})
	//	})

	var sortid = "",
		zongshu = 0,
		articletype = "",
		zishu = "",
		zifenid;
	apiready = function () {


		sortid = api.pageParam.data.sortid;
		EventT.emit("apiready");

		//getData(0);
	};

	var app = angular.module("myApp", []);
	app.controller("DataController", function ($scope) { //angular开始
		$scope.bookList = [];
		$scope.imgurl = imageUrl;

		function getData(page, callback) {
			//	alert(page);alert(articletype);alert(zifenid);alert(zishu);
			$api.post(phpurl + "Home/Book/sortdetail", {
				values: {
					page: page,
					articletype: articletype,
					sortid: zifenid,
					zishu: zishu
				}
			}, function (ret) {
				//		alert($api.jsonToStr(ret));
				var result = ret.result;
				if (ret.code == 200) {
					if (ret.result.length > 0) {

						if (page == 0) {
							$scope.bookList = [];
						}
						$scope.bookList = $scope.bookList.concat(result);

						$scope.$apply();
					} else {

						if (page == 0) {
							$scope.bookList = [];
							$scope.$apply();
						}

						$api.toast('很是遗憾，没加载到数据');


					}
				} else {

				}
				callback && callback(ret);
				// $api.closeloadding();//关闭加载
			})

		}


		function getDatas(page, callback) {
			$api.post(phpurl + "Home/Book/zisort", {
				values: {
					sortid: sortid
				}
			}, function (ret) {

				if (ret.code == 200) {


					$scope.bookList = ret.result.book_zisort_list1;
					$scope.$apply();
					var html = ""; //分类滚动开始
					var rel = ret.result.book_zisort_list2;
					var yushu = rel.length % 4;
					zongshu = rel.length;
					if (yushu == 0) {
						var shuliang = Math.ceil(rel.length / 4);
					} else {
						var shuliang = Math.ceil(rel.length / 4) - 1;
					}

					for (var i = 0; i < shuliang; i++) {
						var yi = i * 4 - 1;
						var er = i * 4;
						var san = (i * 4) + 1;
						var si = (i * 4) + 2;
						if (i == 0) {
							document.getElementById("fengqiang").innerHTML +=
								"<div class='swiper-slide'  ><span  class='huang_se' onclick='ceshi()' id='33' >首页</span><span id=" + er +
								" onclick='ceshi(" + rel[er].sortid + "," + er + ")'>" + rel[er].shortname + "</span><span id=" + san +
								" onclick='ceshi(" + rel[san].sortid + "," + san + ")'>" + rel[san].shortname + "</span><span id=" + si +
								" onclick='ceshi(" + rel[si].sortid + "," + si + ")'>" + rel[si].shortname + "</span></div>";
						} else {
							document.getElementById("fengqiang").innerHTML += "<div class='swiper-slide'  ><span id=" + yi +
								" onclick='ceshi(" + rel[yi].sortid + "," + yi + ")' >" + rel[yi].shortname + "</span><span id=" + er +
								" onclick='ceshi(" + rel[er].sortid + "," + er + ")'>" + rel[er].shortname + "</span><span id=" + san +
								" onclick='ceshi(" + rel[san].sortid + "," + san + ")'>" + rel[san].shortname + "</span><span id=" + si +
								" onclick='ceshi(" + rel[si].sortid + "," + si + ")'>" + rel[si].shortname + "</span></div>";
						}
					}

					if (yushu != 0) {
						var html = "<div class='swiper-slide'>";
						var s = rel.length - yushu;
						var sl = yushu + 1;
						for (var a = 1; a <= sl; a++) {
							if (a == 1) {
								var yi = s - 1;
								html = html + '<span id=' + yi + '  onclick="ceshi(' + rel[yi].sortid + ',' + yi + ')" >' + rel[yi].shortname +
									'</span>';
							} else if (a == 2) {
								var er = s;
								html = html + "<span id=" + er + " onclick='ceshi(" + rel[er].sortid + "," + er + ")' >" + rel[er].shortname +
									"</span>";
							} else if (a == 3) {
								var san = s + 1;
								html = html + "<span id=" + san + "  onclick='ceshi(" + rel[san].sortid + "," + san + ")' >" + rel[san].shortname +
									"</span>";
							}
							if (a == 4) {
								var si = s + 2;
								html = html + "<span  id=" + si + " onclick='ceshi(" + rel[si].sortid + "," + si + ")' >" + rel[si].shortname +
									"</span>";
							}

						}
						document.getElementById("fengqiang").innerHTML += html + "<span></span></div>";
					}
					//document.getElementById("fengqiang").innerHTML=html;

					setInterval(function () {
						var mySwiper2 = new Swiper('#swiper1', {
							//			autoplay: 3000,//可选选项，自动滑动
							slidesPerView: 1,
							//			direction : 'vertical',
							//          pagination: '.swiper-pagination',
							paginationClickable: true,
							spaceBetween: 0,
							loop: false,

						})

					}, 1000);


					// $api.closeloadding();//关闭加载
				} else {

				}
				callback && callback(ret);
				// $api.closeloadding();//关闭加载
			})

		}




		$scope.zishus = function (n, m) {
			zishu = n;
			for (var i = 100; i <= 103; i++) {
				$("#" + i).removeClass('huang_se');
				$("#" + m).addClass('huang_se');
			}
			getData(0);
		}

		$scope.xingshi = function (n, m) {
			articletype = n;
			for (var i = 104; i <= 106; i++) {
				$("#" + i).removeClass('huang_se');
				$("#" + m).addClass('huang_se');
			}
			getData(0);
		}

		$scope.bookdetail = function (dates) {

			api.openWin({
				name: 'win_headerfdsaf',
				url: 'dtail.html',
				pageParam: {
					data: {
						bookid: dates
					}

				}
			});




		}




		EventT.on("apiready", function () {

			getDatas(0);
			$api.up(function (page, callback) {
				getData(page, function (ret) {
					callback && callback(ret);
				})
			});
			$api.pull(function (callback) {
				getData(0, function () {
					callback && callback();
				})
			})

			var ceshi = function (n, m) {

				zifenid = n;
				if (m >= 0) {
					for (var i = 0; i <= zongshu; i++) {
						$("#" + i).removeClass('huang_se');
						$("#" + m).addClass('huang_se');
						$("#33").removeClass('huang_se');
					}

				} else {

					$("#33").addClass('huang_se');
					for (var i = 0; i <= zongshu; i++) {
						$("#" + i).removeClass('huang_se');
					}

				}
				getDatas(0);

			}
		})

	});
</script>

</html>
